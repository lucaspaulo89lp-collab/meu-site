<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Tiger 2048</title>
  <meta name="description" content="Jogo 2048 com Tiger Coins fict√≠cias. Sem apostas. Apenas entretenimento." />
  <script src="../wallet.js"></script>
  <style>
    :root{
      --stroke: rgba(255,255,255,.14);
      --card: rgba(255,255,255,.06);
      --r: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--pt-text);
    }
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .top{
      display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;
      margin-bottom:12px;
    }
    h1{margin:6px 0 4px;font-size:22px}
    p{margin:0;color:var(--pt-muted);line-height:1.55}
    a{color:inherit;text-decoration:none}
    .btn{
      display:inline-flex;gap:10px;align-items:center;
      padding:10px 12px;border-radius:14px;border:1px solid var(--stroke);
      background: var(--card);font-weight:900;color:inherit;text-decoration:none;
    }

    .layout{display:grid;grid-template-columns: 1fr .9fr;gap:12px;align-items:stretch;}
    .card{
      border:1px solid var(--stroke);
      background: var(--card);
      border-radius: 22px;
      padding: 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,.30);
      backdrop-filter: blur(10px);
    }

    .hud{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .pill{
      padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      font-weight:900;font-size:13px;color:rgba(255,255,255,.92);
    }
    .primary{
      border:0;
      background: linear-gradient(135deg, var(--pt-brand), var(--pt-brand2));
      color:#06111f;
      cursor:pointer;
    }

    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      padding:12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
    }
    .cell{
      height:82px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display:grid;place-items:center;
      font-weight:1000;
      font-size: 22px;
      letter-spacing: .4px;
      user-select:none;
    }

    /* Tema + Skin (varia√ß√µes visuais) */
    body[data-skin="classic"] .cell.value{background: linear-gradient(135deg, rgba(54,211,153,.16), rgba(86,208,255,.10));}
    body[data-skin="neon"] .cell.value{background: linear-gradient(135deg, rgba(86,208,255,.22), rgba(155,135,255,.16)); box-shadow: inset 0 0 0 2px rgba(86,208,255,.10);}
    body[data-skin="gold"] .cell.value{background: linear-gradient(135deg, rgba(255,210,90,.22), rgba(255,240,200,.12)); box-shadow: inset 0 0 0 2px rgba(255,210,90,.10);}

    .note{
      margin-top:10px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.86);
      font-size: 13px;
      line-height: 1.55;
    }

    @media (max-width: 980px){
      .layout{grid-template-columns:1fr}
      .cell{height:76px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>üî¢ Tiger 2048</h1>
        <p>Combine blocos. Ganhe <b>Tiger Coins</b> (fict√≠cias) ao atingir metas. Sem apostas.</p>
      </div>
      <a class="btn" href="../index.html">‚Üê Voltar</a>
    </div>

    <div class="layout">
      <div class="card">
        <div class="hud">
          <span class="pill" id="score">Score: 0</span>
          <span class="pill" id="best">Recorde: 0</span>
          <span class="pill" id="pack">Pack: starter</span>
          <button class="btn primary" id="newGame">Novo jogo</button>
        </div>

        <div class="grid" id="grid"></div>

        <div class="note">
          <b>Controles:</b> Setas do teclado (‚Üë ‚Üì ‚Üê ‚Üí) ou arraste na tela (mobile).
        </div>
      </div>

      <div class="card">
        <h1 style="font-size:16px;margin:0 0 6px;">Recompensas</h1>
        <p style="margin:0;color:var(--pt-muted);line-height:1.55;">
          Voc√™ ganha Coins ao alcan√ßar metas ‚Äî apenas 1 vez por meta.
        </p>

        <div class="note">
          <b>Metas:</b><br/>
          256 ‚Üí +2 Coins<br/>
          512 ‚Üí +3 Coins<br/>
          1024 ‚Üí +5 Coins<br/>
          2048 ‚Üí +10 Coins
        </div>

        <div class="note">
          <b>Aviso legal:</b> Coins s√£o fict√≠cias e n√£o podem ser convertidas em dinheiro real.
        </div>

        <div class="note">
          <b>Loja:</b> use Coins para skins/temas/n√≠veis em <a href="../store/" style="text-decoration:underline">/games/store</a>.
        </div>
      </div>
    </div>
  </div>

  <script>
    const gridEl = document.getElementById("grid");
    const scoreEl = document.getElementById("score");
    const bestEl  = document.getElementById("best");
    const packEl  = document.getElementById("pack");
    const newBtn  = document.getElementById("newGame");

    const SIZE = 4;
    let board, score, best;
    let rewarded = {}; // metas j√° pagas nesta instala√ß√£o (persistente)

    function getPack(){
      const s = PT.getSettings();
      return (document.body.dataset.levelpack || s.levelPack || "starter");
    }

    function packSettings(){
      const p = getPack();
      packEl.textContent = "Pack: " + p;

      // Packs mexem em spawn (mais f√°cil ou dif√≠cil):
      // easy: mais chances de spawn 2
      // pro: mais chances de spawn 4
      if(p === "easy") return { chance4: 0.04 };
      if(p === "pro")  return { chance4: 0.16 };
      return { chance4: 0.10 };
    }

    function keyRewards(){
      // metas ficam salvas entre sess√µes para evitar "farm" infinito recome√ßando:
      // (ainda √© fict√≠cio, mas fica mais profissional)
      const key = "pt_2048_rewards";
      try{
        rewarded = JSON.parse(localStorage.getItem(key) || "{}");
      }catch(e){ rewarded = {}; }
      return {
        get(){ return rewarded; },
        set(obj){ rewarded = obj; localStorage.setItem(key, JSON.stringify(rewarded)); }
      };
    }
    const R = keyRewards();

    function emptyBoard(){
      return Array.from({length: SIZE}, () => Array(SIZE).fill(0));
    }

    function randomEmptyCell(){
      const empties = [];
      for(let r=0;r<SIZE;r++){
        for(let c=0;c<SIZE;c++){
          if(board[r][c] === 0) empties.push([r,c]);
        }
      }
      if(empties.length === 0) return null;
      return empties[Math.floor(Math.random()*empties.length)];
    }

    function spawn(){
      const p = packSettings();
      const cell = randomEmptyCell();
      if(!cell) return false;
      const [r,c] = cell;
      const v = (Math.random() < p.chance4) ? 4 : 2;
      board[r][c] = v;
      return true;
    }

    function render(){
      gridEl.innerHTML = "";
      for(let r=0;r<SIZE;r++){
        for(let c=0;c<SIZE;c++){
          const v = board[r][c];
          const d = document.createElement("div");
          d.className = "cell" + (v ? " value" : "");
          d.textContent = v ? String(v) : "";
          gridEl.appendChild(d);
        }
      }
      scoreEl.textContent = "Score: " + score;
      bestEl.textContent  = "Recorde: " + best;
    }

    function compress(line){
      const arr = line.filter(x => x !== 0);
      while(arr.length < SIZE) arr.push(0);
      return arr;
    }

    function merge(line){
      for(let i=0;i<SIZE-1;i++){
        if(line[i] !== 0 && line[i] === line[i+1]){
          line[i] *= 2;
          score += line[i];
          line[i+1] = 0;
          checkMilestone(line[i]);
        }
      }
      return compress(line);
    }

    function moveLeft(){
      let moved = false;
      for(let r=0;r<SIZE;r++){
        const row = board[r].slice();
        const newRow = merge(compress(row));
        if(newRow.join(",") !== row.join(",")) moved = true;
        board[r] = newRow;
      }
      return moved;
    }

    function moveRight(){
      let moved = false;
      for(let r=0;r<SIZE;r++){
        const row = board[r].slice().reverse();
        const newRow = merge(compress(row)).reverse();
        if(newRow.join(",") !== board[r].slice().join(",")) moved = true;
        board[r] = newRow;
      }
      return moved;
    }

    function moveUp(){
      let moved = false;
      for(let c=0;c<SIZE;c++){
        const col = [];
        for(let r=0;r<SIZE;r++) col.push(board[r][c]);
        const newCol = merge(compress(col));
        for(let r=0;r<SIZE;r++){
          if(board[r][c] !== newCol[r]) moved = true;
          board[r][c] = newCol[r];
        }
      }
      return moved;
    }

    function moveDown(){
      let moved = false;
      for(let c=0;c<SIZE;c++){
        const col = [];
        for(let r=0;r<SIZE;r++) col.push(board[r][c]);
        const rev = col.reverse();
        const newCol = merge(compress(rev)).reverse();
        for(let r=0;r<SIZE;r++){
          if(board[r][c] !== newCol[r]) moved = true;
          board[r][c] = newCol[r];
        }
      }
      return moved;
    }

    function canMove(){
      if(randomEmptyCell()) return true;
      for(let r=0;r<SIZE;r++){
        for(let c=0;c<SIZE;c++){
          const v = board[r][c];
          if(r<SIZE-1 && board[r+1][c] === v) return true;
          if(c<SIZE-1 && board[r][c+1] === v) return true;
        }
      }
      return false;
    }

    function checkMilestone(value){
      const rewardMap = {256:2, 512:3, 1024:5, 2048:10};
      if(!rewardMap[value]) return;

      const all = R.get();
      const key = String(value);
      if(all[key]) return; // j√° pagou essa meta alguma vez

      all[key] = true;
      R.set(all);

      PT.addCoins(rewardMap[value]);
      setTimeout(() => {
        alert(`üéâ Meta alcan√ßada: ${value}!\n+${rewardMap[value]} Tiger Coins üêÖ\n\n(As moedas s√£o fict√≠cias e n√£o t√™m valor real.)`);
      }, 60);
    }

    function step(dir){
      let moved = false;
      if(dir === "L") moved = moveLeft();
      if(dir === "R") moved = moveRight();
      if(dir === "U") moved = moveUp();
      if(dir === "D") moved = moveDown();

      if(moved){
        spawn();
        if(score > best){
          best = score;
          localStorage.setItem("pt_2048_best", String(best));
        }
        render();

        if(!canMove()){
          setTimeout(() => alert("Game Over! Clique em 'Novo jogo' para recome√ßar."), 60);
        }
      }
    }

    function newGame(){
      board = emptyBoard();
      score = 0;
      best = Number(localStorage.getItem("pt_2048_best") || 0);
      packSettings();
      spawn();
      spawn();
      render();
    }

    // teclado
    document.addEventListener("keydown", (e) => {
      const k = e.key;
      if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(k)){
        e.preventDefault();
        if(k === "ArrowLeft") step("L");
        if(k === "ArrowRight") step("R");
        if(k === "ArrowUp") step("U");
        if(k === "ArrowDown") step("D");
      }
    });

    // swipe mobile
    let sx=0, sy=0, tracking=false;
    document.addEventListener("touchstart", (e)=>{
      const t = e.touches[0];
      sx = t.clientX; sy = t.clientY; tracking = true;
    }, {passive:true});

    document.addEventListener("touchend", (e)=>{
      if(!tracking) return;
      tracking = false;
      const t = e.changedTouches[0];
      const dx = t.clientX - sx;
      const dy = t.clientY - sy;
      const ax = Math.abs(dx), ay = Math.abs(dy);
      if(Math.max(ax,ay) < 30) return;
      if(ax > ay){
        step(dx > 0 ? "R" : "L");
      }else{
        step(dy > 0 ? "D" : "U");
      }
    }, {passive:true});

    document.addEventListener("DOMContentLoaded", () => {
      PT.ensureHUD();
      PT.applyCosmetics();
      newBtn.addEventListener("click", newGame);
      newGame();
    });
  </script>
</body>
</html>
